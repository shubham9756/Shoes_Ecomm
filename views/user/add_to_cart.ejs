<%-include('navbar.ejs')%>
  <style>
    .product-img {
      width: 120px;
      height: 120px;
      object-fit: contain;
    }

    .quantity-btn {
      width: 30px;
      height: 30px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .cart-summary {
      position: sticky;
      top: 20px;
    }

    @media (max-width: 768px) {
      .mobile-flex-column {
        flex-direction: column !important;
      }

      .mobile-mt-2 {
        margin-top: 0.5rem !important;
      }

      .mobile-text-end {
        text-align: left !important;
      }
    }
  </style>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <div class="container py-5">
    <div class="row mb-4">
      <div class="col">
        <h1 class="fw-bold">Your Cart</h1>
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="#">Home</a></li>
            <li class="breadcrumb-item"><a href="#">Shop</a></li>
            <li class="breadcrumb-item active" aria-current="page">Cart</li>
          </ol>
        </nav>
      </div>
    </div>

    <div class="row">
      <!-- Cart Items -->
      <div class="col-lg-8">
        <div class="card mb-4">
          <div class="card-body">
            <!-- Cart Header -->
            <div class="row fw-bold text-muted d-none d-md-flex py-2 border-bottom">
              <div class="col-md-5">Product</div>
              <div class="col-md-2 text-center">Price</div>
              <div class="col-md-3 text-center">Quantity</div>
              <div class="col-md-2 text-end">Total</div>
            </div>
            <% var sum=0; for(var i=0; i <result.length; i++) { var sum=sum + (result[i].product_price * result[i].qty
              )%>
              <div class="row align-items-center py-3 border-bottom">
                <div class="col-md-5">
                  <div class="d-flex align-items-center">
                    <a href="/delete_cart/<%-result[i].cart_id%>" class="btn btn-outline-danger btn-sm me-3">
                      <i class="bi bi-x-lg"></i>
                    </a>
                    <img src="/product/<%= result[i].product_image %>" alt="Product" class="product-img me-3">
                    <div>
                      <h6 class="mb-1">
                        <%= result[i].product_name %>
                      </h6>
                      <p class="text-muted mb-0">Size: <%= result[i].size %>
                      </p>
                    </div>
                  </div>
                </div>
                <div class="col-md-2 text-center mobile-text-end mobile-mt-2">
                  ₹ <%= result[i].product_price %>
                </div>
                <div class="col-md-3 mobile-flex-column mobile-mt-2">
                  <div class="d-flex align-items-center justify-content-center">
                    <input type="text" class="form-control text-center mx-2" value="<%= result[i].qty %>"
                      style="width: 50px;">
                  </div>
                </div>
                <div class="col-md-2 text-end mobile-text-end mobile-mt-2">
                  ₹ <%= result[i].product_price * result[i].qty %>
                </div>
              </div>
              <% } %>

                <!-- Cart Item 2 -->


                <!-- Continue Shopping -->
                <div class="d-flex justify-content-between mt-4">
                  <a href="/" class="btn btn-outline-primary">
                    <i class="bi bi-arrow-left me-2"></i>Continue Shopping
                  </a>
                  
                </div>
          </div>
        </div>

        <!-- Coupon Code -->

      </div>

      <!-- Order Summary -->
      <div class="col-lg-4">
        <div class="card cart-summary">
          <div class="card-body">
            <h5 class="card-title mb-4">Order Summary</h5>

            <div class="d-flex justify-content-between mb-2">
              <span>Subtotal</span>
              <span>&#8377;<%- sum %></span>
            </div>
            <div class="d-flex justify-content-between mb-2">
              <span>Shipping</span>
              <span>Free /-</span>
            </div>
            <div class="d-flex justify-content-between mb-2">
              <span>Tax</span>
              <span>Free /-</span>
            </div>

            <hr>

            <div class="d-flex justify-content-between fw-bold mb-4">
              <span>Total</span>
              <span>&#8377;<%- sum %></span>
            </div>
            <% if(is_login){ %>
                <button class="btn btn-primary w-100 py-2 mb-3" data-bs-toggle="modal" data-bs-target="#shippingModal">
                  Proceed to Checkout
                </button></a>
              <% }else{%>
                <button class="btn btn-primary w-100 py-2 mb-3" data-bs-toggle="modal" data-bs-target="#emailModal">
                  Proceed to Checkout
                </button></a>
              <%}%>
          </div>
        </div>
      </div>
    </div>
  </div>

<!-- Button to trigger modal -->


<!-- Bootstrap 5 Modal -->
<div class="modal fade" id="shippingModal" tabindex="-1" aria-labelledby="shippingModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form action="/place_order" method="post">
        <div class="modal-header">
          <h5 class="modal-title" id="shippingModalLabel">Shipping Information</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <!-- ✅ Scrollable body with limited height -->
        <div class="modal-body" style="max-height: 60vh; overflow-y: auto;">
          <!-- Row 1 -->
          <div class="row g-3 mb-3">
            <div class="col-md-6">
              <label class="form-label">Full Name</label>
              <input type="text" class="form-control" name="fullname" placeholder="Your name" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">Phone</label>
              <input type="number" class="form-control" name="mobile" placeholder="Mobile number" required maxlength="10">
            </div>
          </div>

          <!-- Row 2 -->
          <div class="row g-3 mb-3">
            <div class="col-md-6">
              <label class="form-label">Pincode</label>
              <input type="text" class="form-control" name="pincode" placeholder="Pincode" onkeyup="searchArea()" id="pincode" required maxlength="6">
            </div>
            <div class="col-md-6">
              <label class="form-label">Country</label>
              <input type="text" class="form-control" name="country" placeholder="Enter Your Country" id="country" required>
            </div>
          </div>

          <!-- Row 3 -->
          <div class="row g-3 mb-3">
            <div class="col-md-6">
              <label class="form-label">State</label>
              <input type="text" class="form-control" name="state" placeholder="Enter Your State" id="state" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">City</label>
              <input type="text" class="form-control" name="city" placeholder="City" id="city" required>
            </div>
          </div>

          <!-- Row 4 -->
          <div class="row g-3 mb-3">
            <div class="col-md-6">
              <label class="form-label">Area</label>
              <input type="text" class="form-control" name="area" placeholder="Area" id="area" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">Payment Mode</label>
              <select class="form-select" name="payment_mode" required>
                <option selected disabled>-- Select Payment Mode --</option>
                <option value="Online">Online</option>
                <option value="Card">Card</option>
                <option value="Cash">Cash</option>
              </select>
            </div>
          </div>

          <!-- Address -->
          <div class="mb-3">
            <label class="form-label">Address</label>
            <textarea class="form-control" name="address" rows="2" placeholder="Full Address" required></textarea>
          </div>

          <!-- Hidden inputs -->
           <% for (var i=0; i < result.length; i++) { %>
          <input type="hidden" name="size" value="<%= result[i].size %>">
          <input type="hidden" name="qty" value="<%= result[i].qty %>">
          <input type="hidden" name="product_id" value="<%= result[i].cart_id%>">
          <% } %>
        </div>

        <!-- ✅ Always-visible footer -->
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary w-100">Place Order</button>
        </div>
      </form>
    </div>
  </div>
</div>


  <script>
    function redirect_buy_now(){
      console.log("Redirecting to buy now page");
      $('#otpModel').modal('hide');
        $('#shippingModal').modal('show');
    }
  </script>
  <%-include('footer.ejs')%>